{% extends 'mainapp/base.html' %}
{% block title %}{{ property.title }}{% endblock %}

{% block content %}
<!-- Property Info -->
<div style="max-width:800px; margin:2rem auto; padding:2rem; background:#f8f8f8; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1); text-align:center;">
  <h2 style="color:#8B4513;">{{ property.title }}</h2>

  <div style="position: relative; display: inline-block;">
    <img src="{{ property.image_main.url }}" style="width:100%; border-radius:8px; margin-bottom:1rem;" alt="{{ property.title }}" />

  <!-- Heart Icon Favorite Button -->
  <form id="favorite-form" method="post" action="{% url 'add_to_favorites' property.pk %}" style="position: absolute; background: transparent; top: 10px; right: 5px; width: 20%;">
    {% csrf_token %}
    <button type="button" id="favorite-button" style="background: transparent; border: none; cursor: pointer;">
      <i class="fas fa-heart" id="heart-icon" style="font-size: 2rem; color: gray;"></i>
    </button>
  </form>

    <!-- SOLD Badge -->
    {% if not property.is_available %}
      <div style="position: absolute; top: 10px; left: 10px; background: red; color: white; padding: 5px 10px; font-weight: bold; border-radius: 5px;">
        SOLD
      </div>
    {% endif %}
  </div>

  <p style="margin-bottom:1rem;">{{ property.description }}</p>
  <p style="margin-bottom:1.5rem;">Price: ksh{{ property.price }}</p>
</div>



<!-- Book Site Visit Section -->
<div style="max-width:800px; margin:2rem auto; padding:2rem; background:#ffffff; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1); text-align:center;">
  <button onclick="toggleVisibility('book-visit-form')" style="padding: 0.7rem 1.5rem; background: #8B4513; color: white; border-radius: 8px; font-weight: bold;">
    Book Site Visit
  </button>
  <div id="book-visit-form" style="display: none; margin-top: 1rem;">
    <form action="{% url 'book_site_visit' property.pk %}" method="post" style="text-align:left;">
      {% csrf_token %}
      
      <input type="hidden" name="property_id" value="{{ property.id }}">
      <div>
        <label for="location">Location:</label>
        <input type="text" id="location" name="location" value="{{ property.location }}" readonly style="width:100%; padding:0.7rem; border-radius:8px; border:1px solid #ccc; font-size:1rem; margin-bottom:1rem;">
      </div>
      <div>
        <label for="property_type">Property Type:</label>
        <input type="text" id="property_type" name="property_type" value="{{ property.property_type }}" readonly style="width:100%; padding:0.7rem; border-radius:8px; border:1px solid #ccc; font-size:1rem; margin-bottom:1rem;">
      </div>
      <div>
        <label for="visit_date">Visit Date:</label>
        <input type="date" id="visit_date" name="visit_date" required style="width:100%; padding:0.7rem; border-radius:8px; border:1px solid #ccc; font-size:1rem; margin-bottom:1rem;">
      </div>
      <button type="submit"
              style="padding:0.7rem 1.5rem; background:#8B4513; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">Submit Booking</button>
    </form>
  </div>
</div>



<!-- Report Issue Section -->
<div style="max-width:800px; margin:2rem auto; padding:2rem; background:#fff5f5; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1); text-align:center;">
  <button onclick="toggleVisibility('report-form')" style="padding: 0.7rem 1.5rem; background: #ff4c4c; color: white; border-radius: 8px; font-weight: bold;">
    Report this property
  </button>
  <div id="report-form" style="display: none; margin-top: 1rem;">
    <form action="{% url 'report_issue' property.pk %}" method="post" style="text-align:left;">
      {% csrf_token %}
      <textarea name="reason" placeholder="Why are you reporting this property?" required
                style="width:100%; padding:0.7rem; min-height:120px; border-radius:8px; border:1px solid #ccc; font-size:1rem; margin-bottom:1rem;"></textarea>
      <button type="submit"
              style="padding:0.7rem 1.5rem; background:#ff4c4c; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">Submit Report</button>
    </form>
  </div>
</div>

<!-- JavaScript to turn heart green after clicking -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const heartIcon = document.getElementById('heart-icon');
    const button = document.getElementById('favorite-button');

    button.addEventListener('click', function () {
      fetch("{% url 'add_to_favorites' property.pk %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}"
        }
      })
      .then(response => {
        if (response.ok) {
          heartIcon.style.color = "green"; // Turn green instantly
        } else {
          alert("Failed to add to favorites.");
        }
      });
    });
  });
</script>

{% endblock %}
